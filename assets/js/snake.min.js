var canvas;var ctx;var cellSize;var keys;var p1;var p2;var mainTimer;var paused;var foodTimer;var food;var foodDelay;init();function init(){cellSize=[10,10];keys=new Array(500);canvas=document.getElementById("myCanvas");ctx=canvas.getContext("2d");p1=new Player(5,100,490,"UP","rgba(255, 0, 0,","Red");p2=new Player(5,400,490,"UP","rgba(0, 0, 255,","Blue");mainTimer=setInterval(gameLoop,100);foodTimer=0;paused=false;food=[];foodDelay=80;spawnFood()}function gameOver(a){clearInterval(mainTimer);setTimeout(clearScreen,10);setTimeout(function(){displayWinner(a)},15);setTimeout(clearVariables,2900);setTimeout(init,3000)}function displayWinner(b){ctx.font="70px Georgia";ctx.fillStyle="#ffffff";var a=b.length*5;ctx.fillText(b+" wins!",110-a,200)}function clearScreen(){ctx.clearRect(0,0,canvas.width,canvas.height)}function clearVariables(){mainTimer=null;cellSize=null;keys=null;p1=null;p2=null;canvas=null;ctx=null}function pause(){paused=!paused}function Cell(b,a){this.x=b;this.y=a}function Player(c,g,f,e,a,b){this.cells=[new Cell(g,f)];this.curDir=e;this.color=a;this.name=b;var d;this.Grow=function(){d=getNextPos(this);this.cells.push(new Cell((d[0]*-1),(d[1]*-1)))};for(i=0;i<c-1;i++){this.Grow()}}window.addEventListener("keydown",function(a){keys[a.keyCode]=true;if([32,37,38,39,40].indexOf(a.keyCode)>-1){a.preventDefault()}});window.addEventListener("keyup",function(a){keys[a.keyCode]=false;if(a.keyCode==32){pause()}});function draw(d,b,c){var a=0.75;var f=0;var e=7;for(i=0;i<d.length;i++){if(c){if(Math.floor(i/e)%2==0){f=(i%e*0.075)}else{f=((e-(i%e))*0.075)}ctx.fillStyle=b+" "+(a-f)+")"}else{ctx.fillStyle=b}ctx.fillRect(d[i].x,d[i].y,cellSize[0],cellSize[1])}}function gameLoop(){if(!paused){clearScreen();whatKeyArrows(p1);if(movePlayer(p1,p2)==-1){return}draw(p1.cells,p1.color,true);whatKeyWASD(p2);if(movePlayer(p2,p1)){return}draw(p2.cells,p2.color,true);draw(food,"green",false);addFoodTimer();if(foodTimer==foodDelay){spawnFood()}}}function whatKeyArrows(a){if(keys[37]&&a.curDir!="RIGHT"){a.curDir="LEFT"}if(keys[39]&&a.curDir!="LEFT"){a.curDir="RIGHT"}if(keys[40]&&a.curDir!="UP"){a.curDir="DOWN"}if(keys[38]&&a.curDir!="DOWN"){a.curDir="UP"}}function whatKeyWASD(a){if(keys[65]&&a.curDir!="RIGHT"){a.curDir="LEFT"}if(keys[68]&&a.curDir!="LEFT"){a.curDir="RIGHT"}if(keys[83]&&a.curDir!="UP"){a.curDir="DOWN"}if(keys[87]&&a.curDir!="DOWN"){a.curDir="UP"}}function movePlayer(g,f){var e=getNextPos(g);var b=g.cells[0].x;var a=g.cells[0].y;var d;var c;if(collision(g.cells,e[0],e[1],1)){gameOver(f.name)}if(collision(food,e[0],e[1],0)){eatFood(g,e[0],e[1])}if(collision(f.cells,e[0],e[1],0)){gameOver(f.name);return -1}g.cells[0].x=e[0];g.cells[0].y=e[1];for(i=1;i<g.cells.length;i++){d=g.cells[i].x;c=g.cells[i].y;g.cells[i].x=b;g.cells[i].y=a;b=d;a=c}}function collision(d,c,b,a){for(i=a;i<d.length;i++){if(d[i].x==c&&d[i].y==b){return true}}return false}function getNextPos(c){var b=c.cells[0].x;var a=c.cells[0].y;switch(c.curDir){case"LEFT":b+=-1*cellSize[0];break;case"UP":a+=-1*cellSize[1];break;case"RIGHT":b+=cellSize[0];break;case"DOWN":a+=cellSize[1];break}if(b>=canvas.width){b=0}else{if(b<0){b=canvas.width}}if(a>=canvas.height){a=0}else{if(a<0){a=canvas.height}}return[b,a]}function spawnFood(){var a=Math.floor((Math.random()*(canvas.width/cellSize[0])))*cellSize[0];var b=Math.floor((Math.random()*(canvas.width/cellSize[1])))*cellSize[1];food.push(new Cell(a,b))}function eatFood(b,a,c){for(i=0;i<food.length;i++){if(food[i].x==a&&food[i].y==c){food.splice(i,1)}}b.Grow()}function addFoodTimer(){if(foodTimer<foodDelay){foodTimer++}else{foodTimer=0}};